
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum VehicleOwnerType {
  self
  company
  rented
}

enum DriverStatus {
  available
  on_route
  off_duty
}

model Driver {
  id                      String          @id @default(uuid()) @db.Uuid
  name                    String
  dob                     DateTime?       @db.Date
  photoUrl                String?         @map("photo_url")
  aadharNo                String?         @unique @map("aadhar_no")
  isAadharVerified        Boolean         @default(false) @map("is_aadhar_verified")
  aadhaarOtpReferenceId   String?         @map("aadhaar_otp_reference_id")
  aadhaarOtpGeneratedAt   DateTime?       @map("aadhaar_otp_generated_at")
  aadharCardFile          String?         @map("aadhar_card_file")
  aadharCardFileKey       String?         @map("aadhar_card_file_key")
  driverLicenseNo         String?         @unique @map("driver_license_no")
  isDriverLicenseVerified Boolean         @default(false) @map("is_driver_license_verified")
  driverLicenseFile       String?         @map("driver_license_file")
  driverLicenseFileKey    String?         @map("driver_license_file_key")
  panCardNo               String?         @unique @map("pan_card_no")
  isPanCardVerified       Boolean         @default(false) @map("is_pan_card_verified")
  panAadhaarLinkStatus    String?         @map("pan_aadhaar_link_status")
  panAadhaarLinkCheckedAt DateTime?       @map("pan_aadhaar_link_checked_at")
  panCardFile             String?         @map("pan_card_file")
  panCardFileKey          String?         @map("pan_card_file_key")

  vehicleOwnerType       VehicleOwnerType? @map("vehicle_owner_type")
  vehiclePlateNo         String?           @map("vehicle_plate_no")
  isVehiclePlateVerified Boolean           @default(false) @map("is_vehicle_plate_verified")
  insuranceNo            String?           @map("insurance_no")
  isInsuranceVerified    Boolean           @default(false) @map("is_insurance_verified")
  insuranceFile          String?           @map("insurance_file")
  insuranceFileKey       String?           @map("insurance_file_key")

  createdAt               DateTime        @default(now()) @map("created_at")
  updatedAt               DateTime        @updatedAt @map("updated_at")
  verifiedDriver          VerifiedDriver?

  email               String
  emailVerified       Boolean   @default(false) @map("email_verified")
  image               String?
  phoneNumber         String?   @unique @map("phone_number")
  phoneNumberVerified Boolean   @default(false) @map("phone_number_verified")
  sessions            Session[]
  accounts            Account[]
  status              DriverStatus  @default(available)
  jobs                Job[]

  @@map("users")
  @@unique([email])
}

model VerifiedDriver {
  driverId    String    @id @map("user_id") @db.Uuid
  isVerified  Boolean   @default(false) @map("is_verified")
  completedAt DateTime? @map("completed_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  driver      Driver    @relation(fields: [driverId], references: [id], onDelete: Cascade)

  @@map("verified_users")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String   @db.Uuid
  user      Driver   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String    @db.Uuid
  user                  Driver    @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model AdminUser {
  id            String         @id @default(uuid()) @db.Uuid
  name          String
  email         String         @unique
  emailVerified Boolean        @default(false) @map("email_verified")
  image         String?        @map("profile_photo_url")
  sessions      AdminSession[]
  accounts      AdminAccount[]
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")




  @@map("admin_users")
}

model AdminSession {
  id        String    @id
  expiresAt DateTime
  token     String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  ipAddress String?
  userAgent String?
  userId    String    @db.Uuid @map("user_id")
  user      AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("admin_session")
}

model AdminAccount {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String    @db.Uuid @map("user_id")
  user                  AdminUser @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("admin_account")
}

model AdminVerification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("admin_verification")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Job {
  id                String   @id @default(uuid()) @db.Uuid
  title             String
  weightKg          Int      @map("weight_kg")

  pickupAddress     String   @map("pickup_address")
  pickupLat         Decimal  @map("pickup_lat") @db.Decimal(9, 6)
  pickupLng         Decimal  @map("pickup_lng") @db.Decimal(9, 6)

  dropAddress       String   @map("drop_address")
  dropLat           Decimal  @map("drop_lat") @db.Decimal(9, 6)
  dropLng           Decimal  @map("drop_lng") @db.Decimal(9, 6)

  pickupAt          DateTime @map("pickup_at")
  dropWindowStartAt DateTime @map("drop_window_start_at")
  dropWindowEndAt   DateTime @map("drop_window_end_at")

  distanceMeters    Int      @map("distance_meters")

  driverId          String?  @map("driver_id") @db.Uuid
  driver            Driver?  @relation(fields: [driverId], references: [id])

  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@index([pickupAt])
  @@map("jobs")
}

// ============================================
// Warehouse Management Models
// ============================================

enum ProductCategory {
  electronics
  food
  apparel
  pharmaceuticals
  machinery
  raw_materials
  packaging
  other
}

enum BlockStatus {
  normal
  warning
  critical
  empty
}

model Warehouse {
  id        String   @id @default(uuid()) @db.Uuid
  name      String
  code      String   @unique
  address   String
  city      String
  workers   Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  floors    Floor[]

  @@map("warehouses")
}

model Floor {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  level       Int
  warehouseId String    @map("warehouse_id") @db.Uuid
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  blocks      Block[]
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@index([warehouseId])
  @@map("floors")
}

model Block {
  id          String          @id @default(uuid()) @db.Uuid
  name        String
  row         String
  column      Int
  capacity    Int
  floorId     String          @map("floor_id") @db.Uuid
  floor       Floor           @relation(fields: [floorId], references: [id], onDelete: Cascade)
  category    ProductCategory
  temperature Decimal?        @db.Decimal(4, 1)
  humidity    Int?
  products    Product[]
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  @@index([floorId])
  @@map("blocks")
}

model Product {
  id           String          @id @default(uuid()) @db.Uuid
  sku          String          @unique
  name         String
  quantity     Int
  category     ProductCategory
  boughtAt     Decimal         @map("bought_at") @db.Decimal(10, 2)
  currentPrice Decimal         @map("current_price") @db.Decimal(10, 2)
  expiryDate   DateTime?       @map("expiry_date")
  blockId      String          @map("block_id") @db.Uuid
  block        Block           @relation(fields: [blockId], references: [id], onDelete: Cascade)
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")

  @@index([blockId])
  @@index([sku])
  @@map("products")
}
